<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis F29 - SIS Sep 2024 - Oct 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --color-bg: #f5f7fa;
            --color-surface: #ffffff;
            --color-text: #1f3a5f;
            --color-text-secondary: #64748b;
            --color-primary: #1f3a5f;
            --color-accent: #ea580c;
            --color-error: #dc2626;
            --color-success: #2563eb;
            --color-border: #e2e8f0;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 16px;
        }
        
        .header {
            background: linear-gradient(135deg, var(--color-primary) 0%, #2d5a8c 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 32px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.95;
        }
        
        .card {
            background: var(--color-surface);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--color-border);
        }
        
        .card h2 {
            color: var(--color-primary);
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .table-wrapper {
            overflow-x: auto;
            margin-top: 16px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        thead {
            background: linear-gradient(135deg, var(--color-primary) 0%, #2d5a8c 100%);
            color: white;
        }
        
        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            user-select: none;
        }
        
        th:hover {
            background: rgba(0, 0, 0, 0.1);
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid var(--color-border);
        }
        
        tbody tr:hover {
            background-color: #f9fafb;
        }
        
        tbody tr:nth-child(even) {
            background-color: #fafbfc;
        }
        
        .number {
            text-align: right;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
        }
        
        .debito {
            color: var(--color-error);
            font-weight: 500;
        }
        
        .credito {
            color: var(--color-success);
            font-weight: 500;
        }
        
        .iva-determinado {
            color: var(--color-accent);
            font-weight: 600;
        }
        
        .total-pagar {
            color: var(--color-accent);
            font-weight: 700;
            background-color: rgba(234, 88, 12, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .search-box {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-box input,
        .search-box select {
            padding: 10px 12px;
            border: 2px solid var(--color-border);
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
            background: white;
        }
        
        .search-box input:focus,
        .search-box select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(31, 58, 95, 0.1);
        }
        
        .search-box input {
            flex: 1;
            min-width: 200px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 24px 0;
        }
        
        .insights {
            background: linear-gradient(135deg, rgba(234, 88, 12, 0.08) 0%, rgba(239, 68, 68, 0.08) 100%);
            padding: 24px;
            border-radius: 8px;
            border-left: 4px solid var(--color-accent);
            margin: 20px 0;
        }
        
        .insight-item {
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .insight-item strong {
            color: var(--color-accent);
        }
        
        .actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary) 0%, #2d5a8c 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(31, 58, 95, 0.2);
        }
        
        .btn-secondary {
            background: var(--color-bg);
            color: var(--color-primary);
            border: 2px solid var(--color-border);
        }
        
        .btn-secondary:hover {
            border-color: var(--color-primary);
        }
        
        .footer {
            text-align: center;
            color: var(--color-text-secondary);
            font-size: 12px;
            margin-top: 32px;
            padding-top: 16px;
            border-top: 1px solid var(--color-border);
        }
        
        @media (max-width: 768px) {
            .header { padding: 24px 16px; }
            .header h1 { font-size: 20px; }
            table { font-size: 12px; }
            th, td { padding: 8px; }
            .chart-container { height: 300px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>An√°lisis F29 - Empresa SIS</h1>
            <p>Per√≠odo Septiembre 2024 - Octubre 2025</p>
        </div>
        
        <div class="card">
            <h2>Datos Fiscales Mensuales</h2>
            
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Buscar por mes o a√±o...">
                <select id="sortOrder">
                    <option value="asc">Orden: Antiguo a Reciente</option>
                    <option value="desc">Orden: Reciente a Antiguo</option>
                </select>
            </div>
            
            <div class="table-wrapper">
                <table id="taxTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Per√≠odo</th>
                            <th class="number">D√©bito IVA</th>
                            <th class="number">Cr√©dito Fiscal</th>
                            <th class="number">Remanente Anterior</th>
                            <th class="number">Total Cr√©ditos</th>
                            <th class="number">IVA Determinado</th>
                            <th class="number">Total a Pagar</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            
            <div class="actions">
                <button class="btn btn-primary" onclick="exportToCSV()">üì• Exportar CSV</button>
                <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Imprimir</button>
            </div>
        </div>
        
        <div class="card">
            <h2>Visualizaci√≥n de Datos</h2>
            <div class="chart-wrapper">
                <canvas id="barChart"></canvas>
            </div>
        </div>
        
        <div class="card">
            <div class="insights">
                <h3 style="color: var(--color-accent); margin-bottom: 16px; font-size: 16px;">üìä Conclusiones Clave del An√°lisis</h3>
                <div class="insight-item"><strong>Decremento Dram√°tico en Octubre 2025:</strong> El total a pagar experimenta un aumento significativo alcanzando $12.012.875 en octubre 2025, comparado con los meses anteriores que mostraban pagos mucho menores desde abril a septiembre 2025.</div>
                <div class="insight-item"><strong>Alerta:</strong> En octubre 2025, el d√©bito IVA cae dram√°ticamente a $5.188.618, pero el IVA determinado salta a $11.479.109, resultando en el segundo total a pagar m√°s alto del per√≠odo despu√©s de los primeros meses.</div>
                <div class="insight-item"><strong>Consumo del Remanente:</strong> Durante el per√≠odo analizado, se observa una disminuci√≥n constante del remanente anterior, que pasa de $101.889.582 en septiembre 2024 a $0 en octubre 2025. Este remanente ha sido fundamental para reducir los pagos mensuales.</div>
                <div class="insight-item"><strong>Relaci√≥n D√©bito-Cr√©dito:</strong> El cr√©dito fiscal mensual es consistentemente bajo (promedio de $1.3M) en comparaci√≥n con el d√©bito IVA (promedio de $12.5M), lo que significa que la empresa depende fuertemente del remanente acumulado.</div>
                <div class="insight-item"><strong>Recomendaci√≥n Estrat√©gica:</strong> Es cr√≠tico aumentar el cr√©dito fiscal mediante la optimizaci√≥n de compras con IVA recuperable, ya que una vez agotado el remanente como en octubre 2025, los pagos de IVA aumentar√°n significativamente.</div>
            </div>
        </div>
        
        <div class="footer">
            Dashboard generado autom√°ticamente | Datos correspondientes a Formulario 29 SIS | Actualizaci√≥n: Nov 2025
        </div>
    </div>
    
    <script>
        const taxData = [
            {mes: 1, periodo: 'Sep 2024', debitoiva: 10887550, creditofiscal: 1052977, remanenteanterior: 101889582, totalcreditos: 143949466, ivadeterminado: 0, totalapagar: 8048727},
            {mes: 2, periodo: 'Oct 2024', debitoiva: 10963713, creditofiscal: 560643, remanenteanterior: 133196035, totalcreditos: 133658584, ivadeterminado: 0, totalapagar: 7228874},
            {mes: 3, periodo: 'Nov 2024', debitoiva: 12847071, creditofiscal: 967626, remanenteanterior: 123921228, totalcreditos: 124882552, ivadeterminado: 0, totalapagar: 8127017},
            {mes: 4, periodo: 'Dic 2024', debitoiva: 13134424, creditofiscal: 1198518, remanenteanterior: 112260519, totalcreditos: 113457011, ivadeterminado: 0, totalapagar: 8274356},
            {mes: 5, periodo: 'Ene 2025', debitoiva: 13265713, creditofiscal: 1087018, remanenteanterior: 100122032, totalcreditos: 101192150, ivadeterminado: 0, totalapagar: 8426930},
            {mes: 6, periodo: 'Feb 2025', debitoiva: 13292326, creditofiscal: 1621786, remanenteanterior: 88893224, totalcreditos: 90515010, ivadeterminado: 0, totalapagar: 8483574},
            {mes: 7, periodo: 'Mar 2025', debitoiva: 13265713, creditofiscal: 1959323, remanenteanterior: 77531408, totalcreditos: 79490731, ivadeterminado: 0, totalapagar: 7996662},
            {mes: 8, periodo: 'Abr 2025', debitoiva: 13411590, creditofiscal: 1156461, remanenteanterior: 66556295, totalcreditos: 67712756, ivadeterminado: 0, totalapagar: 344715},
            {mes: 9, periodo: 'May 2025', debitoiva: 13465210, creditofiscal: 2299223, remanenteanterior: 54409534, totalcreditos: 56598647, ivadeterminado: 0, totalapagar: 530185},
            {mes: 10, periodo: 'Jun 2025', debitoiva: 13532628, creditofiscal: 831695, remanenteanterior: 43220235, totalcreditos: 44051930, ivadeterminado: 0, totalapagar: 624172},
            {mes: 11, periodo: 'Jul 2025', debitoiva: 13559635, creditofiscal: 1669222, remanenteanterior: 30397088, totalcreditos: 32066310, ivadeterminado: 0, totalapagar: 506927},
            {mes: 12, periodo: 'Aug 2025', debitoiva: 13586839, creditofiscal: 1351430, remanenteanterior: 18673151, totalcreditos: 20024581, ivadeterminado: 0, totalapagar: 499771},
            {mes: 13, periodo: 'Sep 2025', debitoiva: 13532431, creditofiscal: 1165190, remanenteanterior: 6437489, totalcreditos: 7602679, ivadeterminado: 5929752, totalapagar: 7055554},
            {mes: 14, periodo: 'Oct 2025', debitoiva: 5188618, creditofiscal: 2175149, remanenteanterior: 0, totalcreditos: 2175149, ivadeterminado: 11479109, totalapagar: 12012875}
        ];
        
        let currentData = [...taxData];
        let currentSort = 'asc';
        
        function formatCurrency(value) {
            return value.toLocaleString('es-CL', {style: 'currency', currency: 'CLP', minimumFractionDigits: 0});
        }
        
        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            data.forEach((row, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${row.mes}</td><td>${row.periodo}</td><td class="number debito">${formatCurrency(row.debitoiva)}</td><td class="number credito">${formatCurrency(row.creditofiscal)}</td><td class="number">${formatCurrency(row.remanenteanterior)}</td><td class="number">${formatCurrency(row.totalcreditos)}</td><td class="number iva-determinado">${formatCurrency(row.ivadeterminado)}</td><td class="number total-pagar">${formatCurrency(row.totalapagar)}</td>`;
                tbody.appendChild(tr);
            });
        }
        
        function filterAndSort() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sort = document.getElementById('sortOrder').value;
            currentSort = sort;
            let filtered = taxData.filter(row => row.periodo.toLowerCase().includes(search));
            if (sort === 'desc') {
                filtered.reverse();
            }
            currentData = filtered;
            renderTable(filtered);
        }
        
        document.getElementById('searchInput').addEventListener('input', filterAndSort);
        document.getElementById('sortOrder').addEventListener('change', filterAndSort);
        
        const labels = taxData.map(d => d.periodo);
        const totalPagar = taxData.map(d => d.totalapagar);
        
        const ctx = document.getElementById('barChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Total a Pagar',
                    data: totalPagar,
                    backgroundColor: '#ea580c',
                    borderColor: '#c2410c',
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Total a Pagar Mensual - Identificaci√≥n de Picos',
                        font: {size: 14, weight: 'bold'},
                        color: '#1f3a5f'
                    },
                    legend: {display: true, position: 'top'}
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + (value / 1000000).toFixed(1) + 'M';
                            }
                        }
                    },
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
        
        function exportToCSV() {
            const headers = 'Mes,Per√≠odo,D√©bito IVA,Cr√©dito Fiscal,Remanente Anterior,Total Cr√©ditos,IVA Determinado,Total a Pagar';
            const rows = currentData.map(row => `${row.mes},${row.periodo},${row.debitoiva},${row.creditofiscal},${row.remanenteanterior},${row.totalcreditos},${row.ivadeterminado},${row.totalapagar}`);
            let csvContent = headers + '\n' + rows.join('\n');
            const blob = new Blob([csvContent], {type: 'text/csvcharset=utf-8'});
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'analisis-f29-sis.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        renderTable(taxData);
    </script>
</body>
</html>
